# Миграция с Legacy UI на Live UI v2

**Дата миграции:** 2024-01-XX  
**Статус:** ✅ Завершено

---

## Обзор

Проект teltel перешёл с Legacy UI v1 (встроенный в backend) на Live UI v2 (отдельный сервис) как единственный пользовательский интерфейс.

### Что изменилось

**До миграции:**
- Legacy UI v1 был встроен в backend и доступен на `http://localhost:8081/`
- Analysis UI был доступен на `http://localhost:8081/analysis.html`
- Backend отдавал статические HTML/JS файлы из директории `web/`

**После миграции:**
- Live UI v2 — единственный пользовательский интерфейс
- Доступен на `http://localhost:3000` (отдельный Docker сервис)
- Backend предоставляет только API и WebSocket endpoints
- Все функции Legacy UI доступны в Live UI v2

---

## Для пользователей

### Как получить доступ к UI

**Единственный способ запуска:**
```bash
make docker-up
# или
docker-compose up -d
```

**Доступные порты:**
- `http://localhost:3000` — **Live UI v2** (единственный UI)
- `http://localhost:8081` — Backend API (только для API, не для UI)

### Что делать, если вы использовали Legacy UI

1. **Если вы использовали `http://localhost:8081/`:**
   - Перейдите на `http://localhost:3000`
   - Все функции доступны в Live UI v2

2. **Если вы использовали `http://localhost:8081/analysis.html`:**
   - Анализ завершённых run'ов доступен в Live UI v2
   - Откройте Live UI v2 и выберите завершённый run из списка

3. **Если вы использовали API напрямую:**
   - Ничего не изменилось
   - API endpoints остались прежними
   - Backend доступен на `http://localhost:8081/api/*`

---

## Технические детали миграции

### Удалённые компоненты

1. **Директория `web/`:**
   - `web/index.html` — главная страница Legacy Live UI
   - `web/app.js` — логика подключения к WebSocket
   - `web/analysis.html` — страница анализа
   - `web/analysis.js` — логика анализа

2. **Backend код:**
   - Функция `findWebDir()` — поиск директории `web/`
   - Код обслуживания статических файлов
   - Логирование "Web UI: http://localhost:%d"

3. **Docker:**
   - Удалена строка `COPY --from=builder /build/web /app/web` из Dockerfile

### Сохранённая функциональность

Все функции Legacy UI реализованы в Live UI v2:

✅ **Live UI функции:**
- Отображение live-графиков в реальном времени
- WebSocket подключение к backend
- Интерактивные графики (zoom, pan, hover)
- Навигация по run'ам
- Синхронизация времени между графиками

✅ **Analysis UI функции:**
- Анализ завершённых run'ов
- Сравнение нескольких run'ов
- Запросы к Analysis API
- Визуализация временных рядов

❌ **Удалённые функции (некритичные):**
- Отображение SQL запросов в UI (низкая критичность)
- Копирование SQL в буфер обмена (можно получить SQL через API)

---

## Архитектурные изменения

### До миграции

```
Browser
  ├── Legacy UI (web/) → http://localhost:8081/
  └── Live UI v2 → http://localhost:3000
         │
         └── Backend (API + UI) → http://localhost:8081
```

### После миграции

```
Browser
  └── Live UI v2 → http://localhost:3000
         │
         └── Backend (API only) → http://localhost:8081
```

### Преимущества новой архитектуры

1. **Разделение ответственности:**
   - Backend фокусируется только на API и WebSocket
   - UI полностью отделён от backend

2. **Улучшенная производительность:**
   - Live UI v2 использует современный стек (React + TypeScript + Vite)
   - Оптимизированная сборка и hot-reload в development

3. **Лучшая масштабируемость:**
   - UI и backend могут масштабироваться независимо
   - Упрощённое развёртывание

4. **Современный стек:**
   - Декларативный Layout (JSON Schema v1.0)
   - Shared State Engine
   - Chart Engine (Observable Plot)
   - Event Timeline (D3)

---

## Обновлённая документация

Следующие документы были обновлены:

1. **`docs/API.md`** — удалены секции Legacy UI и Analysis UI, добавлено замечание о миграции
2. **`docs/USER_GUIDE.md`** — удалены упоминания Legacy UI, обновлены примеры
3. **`README.md`** — обновлена секция "Быстрый старт", указан Live UI v2
4. **`DOCKER.md`** — обновлено описание сервисов
5. **`LIVE_UI_ARCHITECTURE_DESIGN.md`** — добавлена заметка о том, что Live UI v2 является единственным UI

---

## Обратная совместимость

### API

✅ **Полная обратная совместимость:**
- Все API endpoints остались прежними
- WebSocket API не изменился
- Формат событий не изменился

### UI

❌ **Обратная совместимость отсутствует:**
- Legacy UI больше не доступен
- Все пользователи должны использовать Live UI v2

---

## Поддержка

Если у вас возникли проблемы после миграции:

1. Проверьте, что Docker сервисы запущены: `docker-compose ps`
2. Проверьте доступность Live UI v2: `curl http://localhost:3000`
3. Проверьте доступность Backend API: `curl http://localhost:8081/api/health`
4. Обратитесь к документации: [docs/USER_GUIDE.md](USER_GUIDE.md)

---

## История изменений

**2024-01-XX — Завершение миграции:**
- Удалена директория `web/`
- Удалён код обслуживания статических файлов из backend
- Обновлена вся документация
- Live UI v2 зафиксирован как единственный UI

**2024-01-XX — Начало миграции:**
- Проведён аудит функциональности Legacy UI
- Подтверждено, что все критичные функции реализованы в Live UI v2
- Начато обновление документации

---

## Ссылки

- [Архитектура Live UI v2](../LIVE_UI_ARCHITECTURE_DESIGN.md)
- [Руководство пользователя](USER_GUIDE.md)
- [API документация](API.md)
- [Docker документация](../DOCKER.md)
