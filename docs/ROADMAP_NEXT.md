# Roadmap: Планы дальнейшего развития Live UI

Этот документ описывает планы дальнейшего развития Live UI после завершения Live UI v2.

**Важно:** Эти этапы НЕ являются частью Live UI v2. Архитектура v2 зафиксирована и не подлежит изменениям. Все будущие этапы будут строиться на базе архитектуры v2 без изменения контрактов.

---

## Stage 8 — Run Comparison / Analysis UI

### Цель

Добавить возможность сравнения нескольких run'ов на одном графике и расширенный анализ завершённых run'ов.

### Ключевые возможности

#### 8.1 Сравнение нескольких run'ов

- **Overlay графики** — наложение нескольких run'ов на один график
- **Side-by-side графики** — параллельное отображение run'ов
- **Синхронизация по времени** — синхронизация time_cursor между run'ами
- **Цветовое кодирование** — визуальное различие run'ов через цвета
- **Легенда** — отображение метаданных run'ов (run_id, timestamp, tags)

#### 8.2 Регрессионный анализ

- **Выделение различий** — автоматическое обнаружение расхождений между run'ами
- **Статистические метрики** — сравнение средних, дисперсий, максимумов/минимумов
- **Визуализация дельт** — графики разностей между run'ами
- **Аннотации** — маркировка значимых различий

#### 8.3 Оффлайн-режим

- **Загрузка завершённых run'ов** — чтение данных из ClickHouse
- **Кэширование данных** — локальное хранение загруженных run'ов
- **Гибридный режим** — одновременная работа с live и завершёнными run'ами

### Архитектурные принципы

- **Переиспользование ChartSpec** — существующие ChartSpec расширяются для поддержки multiple run_ids
- **Переиспользование Data Layer** — Data Layer расширяется для работы с историческими данными
- **Отсутствие real-time требований** — для завершённых run'ов нет требований к real-time обновлениям
- **Совместимость с v2** — все существующие layout'ы продолжают работать

### Технические детали

- Расширение `data_source` в ChartSpec для поддержки `run_ids: string[]`
- Новый тип графика `run_comparison` (опционально)
- Интеграция с Analysis API (`/api/analysis/query`)
- Кэширование данных завершённых run'ов в Data Layer

---

## E2E-тесты и стабилизация

### Цель

Обеспечить надёжность и стабильность системы через автоматизированное тестирование и профилирование.

### Ключевые задачи

#### E2E-тесты data-flow

- **Тестирование WebSocket подключения** — проверка подключения, переподключения, обработки ошибок
- **Тестирование Data Layer** — проверка ingestion, буферизации, window logic
- **Тестирование Chart Engine** — проверка рендеринга графиков с различными данными
- **Тестирование синхронизации** — проверка синхронизации time_cursor, hover, zoom/pan между графиками

#### Тестирование интерактивных сценариев

- **Hover сценарии** — проверка tooltip на всех типах графиков
- **Time cursor сценарии** — проверка click, drag, синхронизации
- **Zoom/Pan сценарии** — проверка навигации по графикам
- **Live control сценарии** — проверка play/pause, time scrubbing

#### Регрессионная защита

- **Snapshot тесты** — фиксация визуального вывода графиков
- **Performance benchmarks** — отслеживание производительности рендеринга
- **Memory leak тесты** — проверка отсутствия утечек памяти при длительной работе

#### Performance-профилирование

- **Рендеринг больших объёмов данных** — оптимизация для тысяч точек
- **Частота обновлений** — оптимизация real-time обновлений
- **Memory usage** — контроль использования памяти при window logic

#### Стабилизация API

- **Версионирование API** — явное версионирование WebSocket API
- **Обратная совместимость** — гарантии совместимости между версиями
- **Документация API** — подробная документация всех контрактов

### Технические детали

- Использование Playwright или Cypress для E2E-тестов
- Интеграция в CI/CD pipeline
- Performance monitoring и alerting
- Документация тестовых сценариев

---

## Связь с Live UI v2

### Архитектурная база

Live UI v2 является стабильной базой для всех будущих этапов:

- **Layout и ChartSpec контракты** остаются неизменными
- **Data Layer API** расширяется, но обратная совместимость сохраняется
- **Shared State Engine** остаётся центральным механизмом управления состоянием
- **Chart Engine** расширяется новыми типами графиков, но существующие остаются без изменений

### Принципы развития

1. **Обратная совместимость** — все существующие layout'ы и ChartSpec продолжают работать
2. **Расширяемость** — новые возможности добавляются через расширение существующих контрактов
3. **Изоляция** — новые функции не влияют на существующую функциональность
4. **Документирование** — все изменения документируются в отдельном ADR

---

## Приоритизация

Рекомендуемый порядок реализации:

1. **E2E-тесты и стабилизация** — обеспечение надёжности существующей функциональности
2. **Stage 8.1 — Сравнение run'ов** — базовая функциональность сравнения
3. **Stage 8.2 — Регрессионный анализ** — расширенный анализ
4. **Stage 8.3 — Оффлайн-режим** — работа с историческими данными

---

## Ссылки

- [Архитектурный документ](../LIVE_UI_ARCHITECTURE_DESIGN.md)
- [Статус реализации](../live-ui/IMPLEMENTATION_STATUS.md)
- [Руководство пользователя](./USER_GUIDE.md)
