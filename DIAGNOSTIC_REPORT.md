# –û—Ç—á—ë—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏: Frontend –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç Backend

**–î–∞—Ç–∞:** 2026-01-24  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞

---

## 1. –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏–º–ø—Ç–æ–º–∞

Frontend (Live UI) –Ω–µ –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç Backend:
- –ó–∞–ø—Ä–æ—Å—ã –∫ `/api/analysis/runs` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 404
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã `RunList` –∏ `RunSelector` –Ω–µ –º–æ–≥—É—Ç –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ run'–æ–≤
- –í –ª–æ–≥–∞—Ö nginx –≤–∏–¥–Ω—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ 404 –æ—à–∏–±–∫–∏ –Ω–∞ `/api/analysis/runs`

---

## 2. –ù–∞–π–¥–µ–Ω–Ω–∞—è –∫–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** Analysis API endpoints –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ backend, –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. Backend –Ω–µ –º–æ–∂–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å ClickHouse schema
2. –§–∞–π–ª `schema.sql` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
3. `AnalysisHandler` –æ—Å—Ç–∞—ë—Ç—Å—è `nil`, –ø–æ—ç—Ç–æ–º—É routes –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è

**–¶–µ–ø–æ—á–∫–∞ –ø—Ä–∏—á–∏–Ω:**
```
Dockerfile –Ω–µ –∫–æ–ø–∏—Ä—É–µ—Ç schema.sql
  ‚Üì
Backend –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å /build/internal/storage/schema.sql
  ‚Üì
SchemaManager.InitSchema() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É
  ‚Üì
analysisHandler –æ—Å—Ç–∞—ë—Ç—Å—è nil
  ‚Üì
Routes –¥–ª—è /api/analysis/* –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è
  ‚Üì
Frontend –ø–æ–ª—É—á–∞–µ—Ç 404 –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ /api/analysis/runs
```

---

## 3. –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ, –ø–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–∏—á–∏–Ω–∞

### 3.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ endpoints

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- ‚úÖ `GET /api/health` ‚Üí `{"status":"ok"}` (—Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚úÖ `GET /api/runs` ‚Üí `[{"runId":"test-123",...}]` (—Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚ùå `GET /api/analysis/runs` ‚Üí `404 page not found` (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

### 3.2 –õ–æ–≥–∏ backend

```
2026/01/24 00:34:50 Warning: Failed to init ClickHouse schema: failed to read schema: failed to open schema.sql: open /build/internal/storage/schema.sql: no such file or directory
2026/01/24 00:34:50 Analysis endpoints will not be available
```

### 3.3 –ö–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ routes

–í `cmd/teltel/main.go:97-104`:
```go
// Analysis API endpoints (Phase 3 - post-run)
if analysisHandler != nil {
    mux.HandleFunc("/api/analysis/runs", analysisHandler.HandleRuns)
    // ... –¥—Ä—É–≥–∏–µ routes
    log.Printf("Analysis API endpoints registered")
}
```

–ü–æ—Å–∫–æ–ª—å–∫—É `analysisHandler == nil`, routes –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è.

### 3.4 Dockerfile

–í `Dockerfile` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ `schema.sql`:
- –ö–æ–ø–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª `teltel`
- –§–∞–π–ª `internal/storage/schema.sql` –Ω–µ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- Backend –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å `/build/internal/storage/schema.sql`, –Ω–æ —Ñ–∞–π–ª–∞ –Ω–µ—Ç

---

## 4. –ü–ª–∞–Ω –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 4.1 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SchemaManager (–†–ï–ê–õ–ò–ó–û–í–ê–ù–û)

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `embed` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è `schema.sql` –≤ –±–∏–Ω–∞—Ä–Ω–∏–∫

**–§–∞–π–ª:** `internal/storage/schema.go`

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Go `embed` –¥–∏—Ä–µ–∫—Ç–∏–≤—É –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è `schema.sql` –≤ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫. –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–æ–∏—Å–∫–∞ —Ñ–∞–π–ª–∞ –≤ runtime –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –≤ dev, —Ç–∞–∫ –∏ –≤ production –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –î–æ–±–∞–≤–ª–µ–Ω `_ "embed"` –∏–º–ø–æ—Ä—Ç
2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ `//go:embed schema.sql` –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
3. –û–±–Ω–æ–≤–ª—ë–Ω –º–µ—Ç–æ–¥ `readSchemaSQL()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è embedded –≤–µ—Ä—Å–∏–∏ —Å fallback –Ω–∞ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Dockerfile
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (dev, Docker, production)
- ‚úÖ –ë–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 4.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–∏

**–í–∞–∂–Ω–æ:** –ì—Ä–∞—Ñ–∏–∫–∏ –≤ `example-layout.json` –∏—Å–ø–æ–ª—å–∑—É—é—Ç `type: "event_stream"`, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- –û–Ω–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ **WebSocket**, –∞ –Ω–µ —á–µ—Ä–µ–∑ Analysis API
- –ü—Ä–æ–±–ª–µ–º–∞ —Å Analysis API **–Ω–µ –≤–ª–∏—è–µ—Ç** –Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ live –≥—Ä–∞—Ñ–∏–∫–æ–≤
- –ü—Ä–æ–±–ª–µ–º–∞ –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞:
  - –°–ø–∏—Å–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö run'–æ–≤ (`RunList`, `RunSelector`)
  - –ó–∞–≥—Ä—É–∑–∫—É –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Å `type: "historical"` –∏–ª–∏ `type: "hybrid"`

---

## 5. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. ‚úÖ Backend —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç ClickHouse schema
2. ‚úÖ `AnalysisHandler` —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è
3. ‚úÖ Routes –¥–ª—è `/api/analysis/*` —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏
4. ‚úÖ Frontend –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ run'–æ–≤ —á–µ—Ä–µ–∑ `GET /api/analysis/runs`
5. ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã `RunList` –∏ `RunSelector` –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç —Å–ø–∏—Å–æ–∫ run'–æ–≤
6. ‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ —Å `type: "historical"` –∏–ª–∏ `type: "hybrid"` –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Live –≥—Ä–∞—Ñ–∏–∫–∏ (`type: "event_stream"`) –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∏ —Å–µ–π—á–∞—Å, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç WebSocket, –∞ –Ω–µ Analysis API.

---

## 6. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### 6.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞

**–î–µ–π—Å—Ç–≤–∏–µ:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:
- WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `/ws` —Ä–∞–±–æ—Ç–∞–µ—Ç
- Frontend –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ WebSocket
- Live –≥—Ä–∞—Ñ–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### 6.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ nginx proxy

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:**
- `/api/health` –∏ `/api/runs` —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ proxy
- nginx –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ backend

---

## 7. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Dockerfile** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ `schema.sql`
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É—Ç—å –∫ schema.sql** –≤ `SchemaManager` ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—É—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–ª—è runtime
3. **–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑** backend
4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** `/api/analysis/runs` –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å WebSocket** –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è live –¥–∞–Ω–Ω—ã—Ö

---

## 8. –í—ã–≤–æ–¥—ã

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `schema.sql` –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ–º—É, —á—Ç–æ Analysis API –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∏ –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç routes.

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:**
- üî¥ **–í—ã—Å–æ–∫–∞—è** –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö Analysis API (`RunList`, `RunSelector`)
- üü¢ **–ù–∏–∑–∫–∞—è** –¥–ª—è live –≥—Ä–∞—Ñ–∏–∫–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö WebSocket

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ `schema.sql` –≤ Dockerfile –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É—Ç—å –≤ –∫–æ–¥–µ.
